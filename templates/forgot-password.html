<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mot de passe oubli√© ‚Äî Bot4Univ</title>
    <link rel="stylesheet" href="/static/css/styles.css">
  </head>
  <body class="auth-page forgot-password-page">
    <div class="forgot-password-container">
      <div class="forgot-password-card">
        <div class="lock-icon">
          <div class="lock-body"></div>
          <div class="lock-shackle"></div>
          <div class="lock-keyhole"></div>
        </div>

        <h1 class="forgot-password-title">Mot de passe oubli√© ?</h1>
        <p class="forgot-password-subtitle">
          Pas de souci ! Entrez votre email et nous vous enverrons<br>
          un lien pour r√©initialiser votre mot de passe.
        </p>

        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="successMessage" class="success-message" style="display: none;"></div>

        <form id="forgotPasswordForm" class="forgot-password-form">
          <div class="form-group">
            <label for="email" class="form-label">Adresse email</label>
            <div class="input-with-icon">
              <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input"
                placeholder="votre.email@univ-douala.cm"
                required
                autocomplete="email"
              />
              <span class="input-icon">üìß</span>
            </div>
          </div>

          <button type="submit" class="btn-auth-primary" id="resetBtn">
            Envoyer le lien de r√©initialisation
          </button>
        </form>

        <div class="info-box">
          <span class="info-icon">‚ÑπÔ∏è</span>
          <div>
            <p>V√©rifiez votre bo√Æte de r√©ception et vos spams.</p>
            <p>Le lien expire dans 1 heure.</p>
          </div>
        </div>

        <a href="/login" class="back-link">
          <span class="back-arrow">‚Üê</span>
          Retour √† la connexion
        </a>
      </div>

      <footer class="auth-footer">
        ¬© 2025 Bot4Univ - Groupe 19 | Universit√© de Douala
      </footer>
    </div>

    <script>
      document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const errorDiv = document.getElementById('errorMessage');
        const successDiv = document.getElementById('successMessage');
        const resetBtn = document.getElementById('resetBtn');
        
        errorDiv.style.display = 'none';
        successDiv.style.display = 'none';
        resetBtn.disabled = true;
        resetBtn.textContent = 'Envoi...';

        const formData = {
          email: document.getElementById('email').value
        };

        try {
          const response = await fetch('/api/auth/forgot-password', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          });

          const data = await response.json();

          if (response.ok) {
            successDiv.textContent = data.message;
            successDiv.style.display = 'block';
            document.getElementById('forgotPasswordForm').reset();
          } else {
            errorDiv.textContent = data.error || 'Erreur lors de l\'envoi';
            errorDiv.style.display = 'block';
          }
          
          resetBtn.disabled = false;
          resetBtn.textContent = 'Envoyer le lien de r√©initialisation';
        } catch (error) {
          console.error('Forgot password error:', error);
          errorDiv.textContent = 'Erreur de connexion au serveur';
          errorDiv.style.display = 'block';
          resetBtn.disabled = false;
          resetBtn.textContent = 'Envoyer le lien de r√©initialisation';
        }
      });
    </script>
  </body>
</html>
